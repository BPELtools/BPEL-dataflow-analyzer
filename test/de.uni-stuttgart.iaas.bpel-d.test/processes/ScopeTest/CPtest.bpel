<!-- CPtest BPEL Process [Generated by the Eclipse BPEL Designer] -->
<bpel:process name="CPtest"
         targetNamespace="http://gyy.com/CPtestNP"
         suppressJoinFailure="yes"
         xmlns:tns="http://gyy.com/CPtestNP"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         >

    <!-- Import the client WSDL -->
	<bpel:import location="CPtestArtifacts.wsdl" namespace="http://gyy.com/CPtestNP" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
         
    <!-- ================================================================= -->         
    <!-- PARTNERLINKS                                                      -->
    <!-- List of services participating in this BPEL process               -->
    <!-- ================================================================= -->         
    <bpel:partnerLinks>
        <!-- The 'client' role represents the requester of this service. -->
        <bpel:partnerLink name="client"
                     partnerLinkType="tns:CPtest"
                     myRole="CPtestProvider"
                     />
    </bpel:partnerLinks>
  
    <!-- ================================================================= -->         
    <!-- VARIABLES                                                         -->
    <!-- List of messages and XML documents used within this BPEL process  -->
    <!-- ================================================================= -->         
    <bpel:variables>
        <!-- Reference to the message passed as input during initiation -->
        <bpel:variable name="input"
                  messageType="tns:CPtestRequestMessage"/>
                  
        <!-- 
          Reference to the message that will be returned to the requester
          -->
        <bpel:variable name="output"
                  messageType="tns:CPtestResponseMessage"/>
    </bpel:variables>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->   
    <bpel:scope name="outerScope"><bpel:faultHandlers>
        <bpel:catch><bpel:sequence><bpel:compensate></bpel:compensate><bpel:rethrow></bpel:rethrow></bpel:sequence></bpel:catch>
    </bpel:faultHandlers>
    
        <bpel:flow name="Flow"><bpel:links>
            <bpel:link name="link1" />
            <bpel:link name="link2" />
            <bpel:link name="link3" />
            <bpel:link name="link4" />
            <bpel:link name="link5" />
            <bpel:link name="link6" />
        </bpel:links><bpel:receive createInstance="yes" name="A" operation="procss" partnerLink="client" portType="tns:CPtestRequestMessage" variable="input">
            <bpel:sources>
                <bpel:source linkName="link1" />
                <bpel:source linkName="link2" />
            </bpel:sources>
        </bpel:receive>
            <bpel:scope name="Scope">
        	<bpel:targets>
                <bpel:target linkName="link1" />
            </bpel:targets>
            <bpel:sources>
                <bpel:source linkName="link3" />
            </bpel:sources>			            			<bpel:faultHandlers>
    			<bpel:catch faultName="fn" faultVariable="faultVariable">
				<bpel:sequence name="FHseq">
         			<bpel:assign name="C" validate="no">
             			<bpel:copy>
                 			<bpel:from>
                    			<bpel:literal>Ten percent discount</bpel:literal>
                  			</bpel:from>
                      		<bpel:to part="text" variable="output" />
                   		</bpel:copy>
        			</bpel:assign>
					<bpel:compensate name="D" />
				</bpel:sequence>
    			</bpel:catch>
  			</bpel:faultHandlers>
  			<bpel:terminationHandler name="TH1">
  				<bpel:compensate name="CompTH1" />
  			</bpel:terminationHandler>
  			<bpel:empty />
        </bpel:scope><bpel:forEach counterName="Counterxxx" name="E" parallel="no">
                <bpel:targets>
                <bpel:target linkName="link3" />
            </bpel:targets>
            <bpel:sources>
                <bpel:source linkName="link5" />
            </bpel:sources> 
			<bpel:startCounterValue expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0"><![CDATA[1]]></bpel:startCounterValue>
			<bpel:finalCounterValue expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0"><![CDATA[5]]></bpel:finalCounterValue>

                <bpel:scope name="IterateScope"><bpel:compensationHandler>

    					<bpel:assign name="F" validate="no">
							<bpel:copy>
								<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0"><![CDATA[concat($output.payload, " ", $Counter)]]></bpel:from>
								<bpel:to part="payload" variable="output" />
							</bpel:copy>
						</bpel:assign>
    				</bpel:compensationHandler><bpel:terminationHandler>
  				<bpel:compensate />
  			</bpel:terminationHandler>
    				<bpel:empty name="G">

            		</bpel:empty>
            	
            
                
                </bpel:scope>
            </bpel:forEach>
     <bpel:assign name="B" validate="no">
                <bpel:targets>
                	<bpel:target linkName="link2" />
            	</bpel:targets>
            	<bpel:sources>
            		<bpel:source linkName="link6" />
            	</bpel:sources>          
				<bpel:copy>
                	<bpel:from>
                    	<bpel:literal>ABC</bpel:literal>
                	</bpel:from>
                	<bpel:to part="test" variable="output" />
            	</bpel:copy>
     </bpel:assign>
  		<bpel:reply name="H" operation="process" partnerLink="client" portType="tns:CPtestResponseMessage" variable="output">
            <bpel:targets>
                <bpel:target linkName="link5" />
                <bpel:target linkName="link6" />
            </bpel:targets>
        </bpel:reply>				
  
        
        
        
        
        
        
        
        
        
        </bpel:flow>
    </bpel:scope>
</bpel:process>

