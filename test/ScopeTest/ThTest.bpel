<!-- terTest BPEL Process [Generated by the Eclipse BPEL Designer] -->
<bpel:process name="terTest"
         targetNamespace="http://gyy.com/terTestNS"
         suppressJoinFailure="yes"
         xmlns:tns="http://gyy.com/terTestNS"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         >

    <!-- Import the client WSDL -->
	<bpel:import location="terTestArtifacts.wsdl" namespace="http://gyyNS.com" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
         
    <!-- ================================================================= -->         
    <!-- PARTNERLINKS                                                      -->
    <!-- List of services participating in this BPEL process               -->
    <!-- ================================================================= -->         
    <bpel:partnerLinks>
        <!-- The 'client' role represents the requester of this service. -->
        <bpel:partnerLink myRole="terTestProvider"
            name="client" partnerLinkType="tns:terTest" partnerRole="terTestProvider"/>        
    </bpel:partnerLinks>
  
    <!-- ================================================================= -->         
    <!-- VARIABLES                                                         -->
    <!-- List of messages and XML documents used within this BPEL process  -->
    <!-- ================================================================= -->         
    <bpel:variables>
        <!-- Reference to the message passed as input during initiation -->
        <bpel:variable name="input"
                  messageType="tns:terTestRequestMessage"/>
                  
        <!-- 
          Reference to the message that will be returned to the requester
          -->
        <bpel:variable name="output"
                  messageType="tns:terTestResponseMessage"/>
    </bpel:variables>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->                 
    <bpel:flow name="Flow">
        <bpel:links>
            <bpel:link name="link1" />
            <bpel:link name="link2" />
            <bpel:link name="link3" />
            <bpel:link name="link4" />
            <bpel:link name="link5" />
    	</bpel:links><bpel:receive createInstance="yes" name="A" partnerLink="client" portType="tns:test2" operation="process" variable="input"> 
            <bpel:sources>
                <bpel:source linkName="link1">
                	<bpel:transitionCondition><![CDATA[$input.status="Deutsch"]]></bpel:transitionCondition>
               </bpel:source>
                <bpel:source linkName="link2">
                	<bpel:transitionCondition><![CDATA[$input.status="Englisch"]]></bpel:transitionCondition>
                </bpel:source>
            </bpel:sources>         
        </bpel:receive>
  <bpel:scope name="Scope">
            <bpel:targets>
                <bpel:target linkName="link1" />
            </bpel:targets>
            <bpel:sources>
                <bpel:source linkName="link5" />
            </bpel:sources>

            <bpel:terminationHandler>
                <bpel:assign name="F" validate="no">
                        <bpel:copy>
                            <bpel:from>
                                <bpel:literal>Ten percent discount</bpel:literal>
                            </bpel:from>
                            <bpel:to part="text" variable="output" />
                        </bpel:copy>
                </bpel:assign>
            </bpel:terminationHandler>

            <bpel:flow>
                <bpel:invoke inputVariable="input" name="B" operation="dynamicDiscount" outputVariable="output" partnerLink="discountLink" portType="tns:terTest">
                    <bpel:sources>
                        <bpel:source linkName="link3" />
                    </bpel:sources>
                </bpel:invoke><bpel:assign name="C" validate="no">
                    <bpel:targets>
                        <bpel:target linkName="link3" />
                    </bpel:targets>
                    <bpel:copy>
                        <bpel:from><bpel:literal>discount</bpel:literal></bpel:from>
                        <bpel:to part="text" variable="output" />
                    </bpel:copy>
                </bpel:assign>    
            
            </bpel:flow>
        </bpel:scope>
	    <bpel:assign name="D" validate="no">
                <bpel:targets>
                	<bpel:target linkName="link2" />
            	</bpel:targets>
            	<bpel:sources>
            		<bpel:source linkName="link4" />
            	</bpel:sources>          
				<bpel:copy>
                	<bpel:from>
                    	<bpel:literal>ABC</bpel:literal>
                	</bpel:from>
                	<bpel:to part="text" variable="output" />
            	</bpel:copy>
     </bpel:assign> 
     <bpel:reply name="E" partnerLink="client" portType="tns:test2" operation="process" variable="output" >
         <bpel:targets>
            <bpel:target linkName="link4" />
            <bpel:target linkName="link5" />
        </bpel:targets> 
        </bpel:reply>     
    </bpel:flow>
</bpel:process>




